<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}} - Crypto Paste</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" media="(prefers-color-scheme: dark)">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><a href="/">üîê Crypto Paste</a></h1>
            <div class="paste-meta">
                <span>{{TITLE}}</span>
                <span>Language: {{LANGUAGE}}</span>
                <span>Views: {{VIEWS}}</span>
                {{EXPIRES_INFO}}
            </div>
        </header>
        
        <main>
            <div class="paste-actions">
                <button id="copyBtn">Copy to Clipboard</button>
                <button id="downloadBtn">Download</button>
                <button id="rawBtn">Raw Text</button>
                <a href="/">Create New Paste</a>
            </div>
            
            <div class="paste-content">
                <pre><code class="language-{{LANGUAGE}}">{{CONTENT}}</code></pre>
            </div>
        </main>
        
        <footer>
            <p>Built with Cloudflare Workers | <button id="themeToggle">üåô Dark Mode</button></p>
        </footer>
    </div>
    
    <script>
        // Theme management
        function loadTheme() {
            const savedTheme = localStorage.getItem('crypto-paste-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            setTheme(theme);
        }
        
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('crypto-paste-theme', theme);
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            }
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }
        
        // Initialize theme
        loadTheme();
        
        // Copy functionality
        document.getElementById('copyBtn').addEventListener('click', async () => {
            const content = document.querySelector('code').textContent;
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(content);
                } else {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = content;
                    textArea.style.position = 'absolute';
                    textArea.style.left = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            } catch (error) {
                console.error('Copy failed:', error);
                alert('Failed to copy to clipboard');
            }
        });
        
        // Download functionality
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const content = document.querySelector('code').textContent;
            const title = '{{TITLE}}' || 'paste';
            const language = '{{LANGUAGE}}' || 'txt';
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title}.${getFileExtension(language)}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // Raw text view
        document.getElementById('rawBtn').addEventListener('click', () => {
            const content = document.querySelector('code').textContent;
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                    <head>
                        <title>Raw Text - {{TITLE}}</title>
                        <style>
                            body { 
                                font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; 
                                margin: 20px;
                                line-height: 1.5;
                                white-space: pre-wrap;
                                word-wrap: break-word;
                            }
                        </style>
                    </head>
                    <body>${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</body>
                </html>
            `);
            newWindow.document.close();
        });
        
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // System theme change detection
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('crypto-paste-theme')) {
                setTheme(e.matches ? 'dark' : 'light');
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+C / Cmd+C to copy (when not in text selection)
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && !window.getSelection().toString()) {
                e.preventDefault();
                document.getElementById('copyBtn').click();
            }
            
            // Ctrl+S / Cmd+S to download
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                document.getElementById('downloadBtn').click();
            }
            
            // Ctrl+R / Cmd+R for raw view
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                document.getElementById('rawBtn').click();
            }
        });
        
        // Helper function to get file extension
        function getFileExtension(language) {
            const extensions = {
                'javascript': 'js',
                'typescript': 'ts',
                'python': 'py',
                'html': 'html',
                'css': 'css',
                'json': 'json',
                'markdown': 'md',
                'bash': 'sh',
                'sql': 'sql',
                'java': 'java',
                'cpp': 'cpp',
                'c': 'c',
                'php': 'php',
                'ruby': 'rb',
                'go': 'go',
                'rust': 'rs',
                'xml': 'xml',
                'yaml': 'yml'
            };
            return extensions[language] || 'txt';
        }
        
        // Add tooltips for keyboard shortcuts
        document.getElementById('copyBtn').title = 'Copy to Clipboard (Ctrl+C)';
        document.getElementById('downloadBtn').title = 'Download File (Ctrl+S)';
        document.getElementById('rawBtn').title = 'View Raw Text (Ctrl+R)';
        
        // Print styles enhancement
        window.addEventListener('beforeprint', function() {
            const actions = document.querySelector('.paste-actions');
            if (actions) {
                actions.style.display = 'none';
            }
        });
        
        window.addEventListener('afterprint', function() {
            const actions = document.querySelector('.paste-actions');
            if (actions) {
                actions.style.display = 'flex';
            }
        });
    </script>
</body>
</html> 